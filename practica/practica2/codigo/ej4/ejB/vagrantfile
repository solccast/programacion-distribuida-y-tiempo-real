Vagrant.configure("2") do |config|
    config.vm.define "vm1" do |machine|
        machine.vm.box = "hashicorp/bionic64"
        machine.vm.network "private_network", type: "dhcp"
        machine.vm.hostname = "vm1"
    
        # Instalamos dependencias básicas
        machine.vm.provision "shell", inline: <<-SHELL
            apt-get update
            apt-get install -y net-tools libc-dev-bin build-essential
            # The alias for ls
            grep -q "alias ls='ls -la'" /home/vagrant/.bashrc || echo -e "\\nalias ls='ls -la'" >> /home/vagrant/.bashrc

            SERVER_IP=$(hostname -I | awk '{print $2}')
            echo $SERVER_IP > /vagrant/server_ip.txt
        
            # Compilar el servidor
            gcc /vagrant/server_prueba.c -o /home/vagrant/server_prueba    
            cp /vagrant/run_server.sh /home/vagrant/run_server.sh
            sed -i 's/\r$//' /home/vagrant/run_server.sh # Eliminar caracteres de fin de línea de Windows
            chmod +x /home/vagrant/run_server.sh
            nohup /home/vagrant/run_server.sh > /vagrant/server.log 2>&1 &
        SHELL

    end
end


        

